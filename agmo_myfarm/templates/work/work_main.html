{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAugqKOAcVwjdxOVtXgZDJJ1TAJ7giG8YY"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>

        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
            
        }
        header {
            text-align: center;
        }
        main {
            display: flex;
            flex: 1;
        }
        
        .scrollable-area {
            
            overflow-y: auto; /* 세로 스크롤 활성화 */
            
        }
        .weather_content {
            display: flex;
            flex-direction: row;
        }
        .machine_page {
            background-color: #f8f6f6;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .map_page {
            flex: 2;     
        }

        .date {
            margin-top : 5px;
            margin-left : 15px;
            margin-right: 20px;
            font-size: 16px;
            font-weight: 800;
            color: #7a7979;;
        }
        .weather_icon {
            position: absolute;
            left: 40px;
           
            margin: 30px;
            z-index: 1;
            font-size: 24px;
            font-weight: 800;
        }
        .temperature {
            position: absolute;
            top: 30px;
            left: 30px;
           
            margin: 10px;
            z-index: 2;
            font-size: 32px;
            font-weight: 800;
        }
        .weather_etc {
            margin-top : 5px;
            margin-left : 60px;
            flex: 1;
            font-size: 16px;
            font-weight: 800;
            color: #7a7979;
        }

        .machine_content {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            height: 500px;
        }
        .accordion-button::after {
            position: absolute;
            top: 85%;
            left: 45%
            /* 다른 위치 및 스타일링을 원하는 대로 조정 */
        }
        .autonomous-driving {
        background-color: #4b765b; /* 녹색 */
        }
        .stop {
        background-color: #9b3a33; /* 빨간색 */
        }
        

    </style>
</head>
<body>
    
    <header>
        <!-- 헤더 고정 -->
        {% include 'work/header.html' with content=farm_list %}
    </header>

    <main>
        <div class="machine_page">
            <!-- 날씨 부분 -->
            <div class="accordion accordion-flush" id="accordionFlushExample">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button style="z-index: 2; padding: 10px; padding-top: 20px; height:123px; background-color: #ffffff;" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                            <div class="weather_content">

                                <div class="date">
                                    <p>{{ wea.weather_date }}</p>
                                </div>

                                <div class="weather_icon"> 
                                    {% if wea.rain_sh == '없음' %}
                                        {% if wea.sky_sh == '맑음' %}
                                        <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="width: 80px;">

                                        {% elif wea.sky_sh == '구름많음' %}
                                        <img src="https://cdn-icons-png.flaticon.com/512/494/494435.png" style="width: 80px;">

                                        {% elif wea.sky_sh == '흐림' %}
                                        <img src="https://cdn-icons-png.flaticon.com/512/3222/3222801.png" style="width: 80px;">

                                        {% else %}
                                        <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="width: 80px;">

                                        {% endif %}
                                    {% elif wea.rain_sh == '비' %}
                                    <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="width: 80px;">

                                    {% elif wea.rain_sh == '비/눈' %}
                                    <img src="https://cdn-icons-png.flaticon.com/512/6631/6631733.png" style="width: 80px;">

                                    {% elif wea.rain_sh == '눈' %}
                                    <img src="https://cdn-icons-png.flaticon.com/512/2315/2315309.png" style="width: 80px;">

                                    {% elif wea.rain_sh == '소나기' %}
                                    <img src="https://cdn-icons-png.flaticon.com/512/4834/4834677.png" style="width: 80px;">

                                    {% else %}
                                    <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="width: 80px;">

                                    {% endif %}
                                </div>

                                <div class="temperature">
                                    <p>{{ wea.temperature }}°</p>
                                </div>

                                <div class="weather_etc">
                                    <p style="line-height: 1.2; margin-bottom: 5px;">강수확률: {{ wea.is_rain }}%</p>
                                    <p style="line-height: 1.2; margin-bottom: 5px;">습도: {{ wea.humidity }}%</p>
                                    <p style="line-height: 1.2; margin-bottom: 5px;">풍속: {{ wea.wind_speed }}m/s ({{ wea.wind_direction }})</p>
                                    <p style="line-height: 1.5; color: rgb(45, 45, 45); margin-top: 16px;">하늘상태: {{ wea.sky_sh }}</p>
                                </div>
                                
                                
                            </div>
                        </button>
                        
                    </h2>

                    <!-- 펼쳐질 부분 -->
                    <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                        <div class="accordion-body" style="font-size: 16px; font-weight: 800; background-color: #f5f0fa; padding: 10px; padding-top: 0;">
                            <div class="card" style="border-width: 0;">
                                <div class="card-body">
                                    <!-- 위치 -->
                                    <div id="now_loc" style="display: flex; color:#7a7979; font-size: 14px; margin-bottom: 15px; margin-top: 5px;">
                                        위치는 여기입니다.
                                    </div>   
                                    

                                    <!-- 오늘 날씨 카드 -->
                                    <hr>
                                    <div style="display: flex;">
                                        <div style="display: flex; flex-direction: column;">
                                            <div>{{ day_week.0|date:"l"|slice:"0:1" }}(오늘)</div>
                                            <div style="font-size: 13px;">
                                                {{ day_list.0 }}
                                            </div>
                                        </div>
                                        <div style="display: flex;">
                                            {% if wea.rain_sh == '없음' %}
                                                {% if wea.sky_sh == '맑음' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.min_tem }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.max_tem }}°</div>

                                                {% elif wea.sky_sh == '구름많음' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/494/494435.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.min_tem }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.max_tem }}°</div>

                                                {% elif wea.sky_sh == '흐림' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/3222/3222801.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.min_tem }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.max_tem }}°</div>

                                                {% else %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.min_tem }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.max_tem }}°</div>

                                                {% endif %}

                                            {% elif wea.rain_sh == '비' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.min_tem }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.max_tem }}°</div>

                                            {% elif wea.rain_sh == '비/눈' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/6631/6631733.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.min_tem }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.max_tem }}°</div>   

                                            {% elif wea.rain_sh == '눈' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/2315/2315309.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.min_tem }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.max_tem }}°</div>  

                                            {% elif wea.rain_sh == '소나기' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/4834/4834677.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.min_tem }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.max_tem }}°</div>

                                            {% else %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.min_tem }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.max_tem }}°</div>
                                            {% endif %}
                                        </div>

                                    </div>

                                    <!-- 내일 날씨 카드 -->
                                    <hr>
                                    <div style="display: flex;">
                                        <div style="display: flex; flex-direction: column; margin-right: 24px;">
                                            <div>{{ day_week.1|date:"l"|slice:"0:1" }}</div>
                                            <div style="font-size: 13px;">
                                                {{ day_list.1 }}
                                            </div>
                                        </div>
                                        <div style="display: flex;">
                                            {% if wea.one_after_rain_sh == '없음' %}
                                                {% if wea.one_after_sky_sh == '맑음' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.one_after_sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.one_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.one_after_max }}°</div>

                                                {% elif wea.one_after_sky_sh == '구름많음' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/494/494435.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.one_after_sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.one_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.one_after_max }}°</div>

                                                {% elif wea.one_after_sky_sh == '흐림' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/3222/3222801.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.one_after_sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.one_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.one_after_max }}°</div>

                                                {% else %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.one_after_sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.one_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.one_after_max }}°</div>

                                                {% endif %}

                                            {% elif wea.one_after_rain_sh == '비' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.one_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.one_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.one_after_max }}°</div>

                                            {% elif wea.one_after_rain_sh == '비/눈' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/6631/6631733.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.one_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.one_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.one_after_max }}°</div>   

                                            {% elif wea.one_after_rain_sh == '눈' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/2315/2315309.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.one_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.one_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.one_after_max }}°</div>  

                                            {% elif wea.one_after_rain_sh == '소나기' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/4834/4834677.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.one_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.one_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.one_after_max }}°</div>

                                            {% else %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.one_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.one_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.one_after_max }}°</div>
                                            {% endif %}
                                        </div>

                                    </div>

                                    <!-- 2일뒤 날씨 카드 -->
                                    <hr>
                                    <div style="display: flex;">
                                        <div style="display: flex; flex-direction: column; margin-right: 24px;">
                                            <div>{{ day_week.2|date:"l"|slice:"0:1" }}</div>
                                            <div style="font-size: 13px;">
                                                {{ day_list.2 }}
                                            </div>
                                        </div>
                                        <div style="display: flex;">
                                            {% if wea.two_after_rain_sh == '없음' %}
                                                {% if wea.two_after_sky_sh == '맑음' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.two_after_sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.two_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.two_after_max }}°</div>

                                                {% elif wea.two_after_sky_sh == '구름많음' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/494/494435.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.two_after_sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.two_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.two_after_max }}°</div>

                                                {% elif wea.two_after_sky_sh == '흐림' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/3222/3222801.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.two_after_sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.two_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.two_after_max }}°</div>

                                                {% else %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.two_after_sky_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.two_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.two_after_max }}°</div>

                                                {% endif %}

                                            {% elif wea.two_after_rain_sh == '비' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.two_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.two_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.two_after_max }}°</div>

                                            {% elif wea.two_after_rain_sh == '비/눈' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/6631/6631733.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.two_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.two_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.two_after_max }}°</div>   

                                            {% elif wea.two_after_rain_sh == '눈' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/2315/2315309.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.two_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.two_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.two_after_max }}°</div>  

                                            {% elif wea.two_after_rain_sh == '소나기' %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/4834/4834677.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.two_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.two_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.two_after_max }}°</div>

                                            {% else %}
                                            <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                            <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.two_after_rain_sh }}</div>
                                            <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.two_after_min }}°</div>
                                            <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                            <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.two_after_max }}°</div>
                                            {% endif %}
                                        </div>

                                    </div>

                                    <!-- 3일뒤 날씨 카드 -->
                                    {% if wea.three_after_min is not None %}
                                        <hr>
                                        <div style="display: flex;">
                                            <div style="display: flex; flex-direction: column;  margin-right: 24px;">
                                                <div>{{ day_week.3|date:"l"|slice:"0:1" }}</div>
                                                <div style="font-size: 13px;">
                                                    {{ day_list.3 }}
                                                </div>
                                            </div>
                                            <div style="display: flex;">
                                                {% if wea.three_after_rain_sh == '없음' %}
                                                    {% if wea.three_after_sky_sh == '맑음' %}
                                                    <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                    <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.three_after_sky_sh }}</div>
                                                    <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.three_after_min }}°</div>
                                                    <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                    <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.three_after_max }}°</div>

                                                    {% elif wea.three_after_sky_sh == '구름많음' %}
                                                    <img src="https://cdn-icons-png.flaticon.com/512/494/494435.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                    <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.three_after_sky_sh }}</div>
                                                    <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.three_after_min }}°</div>
                                                    <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                    <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.three_after_max }}°</div>

                                                    {% elif wea.three_after_sky_sh == '흐림' %}
                                                    <img src="https://cdn-icons-png.flaticon.com/512/3222/3222801.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                    <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.three_after_sky_sh }}</div>
                                                    <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.three_after_min }}°</div>
                                                    <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                    <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.three_after_max }}°</div>

                                                    {% else %}
                                                    <img src="https://cdn-icons-png.flaticon.com/512/3222/3222675.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                    <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.three_after_sky_sh }}</div>
                                                    <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.three_after_min }}°</div>
                                                    <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                    <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.three_after_max }}°</div>

                                                    {% endif %}

                                                {% elif wea.three_after_rain_sh == '비' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.three_after_rain_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.three_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.three_after_max }}°</div>

                                                {% elif wea.three_after_rain_sh == '비/눈' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/6631/6631733.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.three_after_rain_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.three_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.three_after_max }}°</div>   

                                                {% elif wea.three_after_rain_sh == '눈' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/2315/2315309.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.three_after_rain_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.three_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.three_after_max }}°</div>  

                                                {% elif wea.three_after_rain_sh == '소나기' %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/4834/4834677.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.three_after_rain_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.three_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.three_after_max }}°</div>

                                                {% else %}
                                                <img src="https://cdn-icons-png.flaticon.com/512/4439/4439057.png" style="margin-left: 120px; margin-right: 0px; width: 60px;">
                                                <div style="margin-right: 70px; margin-top: 30px; white-space: nowrap; color: #6a6a6a;">{{ wea.three_after_rain_sh }}</div>
                                                <div style="color: rgba(0, 0, 255, 0.51); margin-top: 6px; font-size: 30px;">{{ wea.three_after_min }}°</div>
                                                <div style="font-size: 30px; font-weight: 100; margin-top: 6px; margin-right: 5px; color: #b5b5b5;"> / </div>
                                                <div style="color: rgba(255, 0, 0, 0.51); font-size: 36px; margin-top: 2px;">{{ wea.three_after_max }}°</div>
                                                {% endif %}
                                            </div>

                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <!-- 미세먼지 카드 -->
                            <div style="display: flex;">
                                <div class="card" style="border-width: 0; margin-top: 10px; margin-right: 10px; flex:1;  background-color: rgba(13, 0, 255, 0.07);">
                                    <div class="card-body text-center">
                                        
                                        <img src="https://cdn-icons-png.flaticon.com/512/3071/3071487.png" style="width: 36px;">
                                        <div>미세먼지</div>
                                        <div style="font-size: 13px; color:#7a7979;">
                                            좋음
                                        </div>
                                    </div>
                                </div>

                                <div class="card" style="border-width: 0; margin-top: 10px; flex:1; background-color: rgba(255, 0, 0, 0.07);">
                                    <div class="card-body text-center">
                                        
                                        <img src="https://cdn-icons-png.flaticon.com/512/6421/6421095.png" style="width: 36px;">
                                        <div>자외선 지수</div>
                                        <div style="font-size: 13px; color:#7a7979;">
                                            나쁨 
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <hr style="margin: 0;">

            <div class="machine_content scrollable-area">
                <!-- 탑뷰 -->
                <div style="display:flex;">
                    <div style="flex:4; font-size: 18px; font-weight: 800; margin-top:15px; margin-left:10px; display: flex;">
                        <span class="material-symbols-outlined" style="font-size: 28px; margin-right:10px;">
                            list
                        </span>
                        
                        <div style="white-space: nowrap;">작업기 현황</div>
                        <div style="position: relative; bottom: 3px; margin-left: 10px; margin-right: 10px; color:#7a7979">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left" viewBox="0 0 16 16">
                                <path d="M10 12.796V3.204L4.519 8 10 12.796zm-.659.753-5.48-4.796a1 1 0 0 1 0-1.506l5.48-4.796A1 1 0 0 1 11 3.204v9.592a1 1 0 0 1-1.659.753z"/>
                            </svg>
                        </div>
                        <div style="position: relative; bottom: 3px; margin-left: 10px; margin-right: 7px; color:#7a7979">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-map" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"/>
                            </svg>
                        </div>
                        <div style="color:#7a7979">
                            {{ wea.field_name }}
                        </div>
                    </div>
                    <div style="flex:1;">
                        <a href="{% url 'work:add_work' %}">
                            <button type="button" class="btn" style="color:rgb(0, 161, 49); font-size:0px; margin-top:10px; --bs-btn-padding-y: .2rem; --bs-btn-padding-x: .4rem; --bs-btn-border-radius: 0rem; border-bottom: 2px solid rgb(0, 161, 49); padding-bottom: 5px; position: relative; top:5px;">
                                
                                <div style="font-size: 14px; font-weight: 800; line-height: 1;">작업추가</div>
                            </button> 
                        </a>
                    </div>
                </div>


                <!-- 카드뷰 -->
                {% if is_work %}
                    {% for card in work_list %}
                        {% if card.work_fields.is_selected %}
                            <div style="margin-top: 20px; display:flex; justify-content: center;">
                                <div class="card" style="width: 480px; height: 120px">
                                    <div class="card-body">
                                        <div>
                                            <!-- 왼쪽에 정렬되는 요소들 -->
                                            <div style="display: flex; align-items: center;">
                                                <!-- 작업기 아이콘 -->
                                                {% if card.machine_name == '파종기' %}
                                                    <span class="material-symbols-outlined" style="z-index: 2; position:relative; bottom:5px;">
                                                        wrist
                                                    </span>
                                                {% elif card.machine_name == '써레' %}
                                                    <span class="material-symbols-outlined" style="z-index: 2; position:relative; bottom:5px;">
                                                        auto_towing
                                                    </span>
                                                {% elif card.machine_name == '스프레이어' %}
                                                    <span class="material-symbols-outlined" style="z-index: 2; position:relative; bottom:5px;">
                                                        sprinkler
                                                    </span>
                                                {% endif %}
                                                
                                                <!-- 진행률(배경색) -->
                                                {% if card.machine_name == '파종기' %}
                                                    <span id="progressIcon{{ card.id }}" class="material-symbols-outlined opacity-50" style="font-size: 40px; position: relative; right: 33px; bottom: 7px; color: red; z-index: 1;">
                                                        clock_loader_90
                                                    </span>
                                                {% elif card.machine_name == '써레' %}
                                                    <span id="progressIcon{{ card.id }}" class="material-symbols-outlined opacity-50" style="font-size: 40px; position: relative; right: 33px; bottom: 7px; color: blue; z-index: 1;">
                                                        clock_loader_90
                                                    </span>
                                                {% elif card.machine_name == '스프레이어' %}
                                                    <span id="progressIcon{{ card.id }}" class="material-symbols-outlined opacity-50" style="font-size: 40px; position: relative; right: 33px; bottom: 7px; color: green; z-index: 1;">
                                                        clock_loader_90
                                                    </span>
                                                {% endif %}
                                                <!-- 테두리 -->
                                                <span class="material-symbols-outlined" style="font-size: 40px; position: relative; right: 73px; bottom: 7px; z-index: 3;">
                                                    circle
                                                </span>
                                                <!-- 작업명 -->
                                                <h5 style="margin-right: 10px; font-size: 16px; font-weight: 800; position:relative; right:65px; bottom: 12px; white-space: nowrap;">{{card.machine_name}}</h5>
                                            </div>
                                            <h6 class="card-subtitle mb-2 text-body-secondary" style="margin-top: 8px; font-size: 12px; font-weight: 800; position:relative; left:37px; bottom:30px;">작업명: {{ card.work_name }}</h6>
                                        
                                            <!-- 오른쪽에 정렬되는 요소들 -->
                                            <div style="display: flex; justify-content: flex-end; position:relative; bottom:80px; left:10px;">
                        
                                                <!-- 와이파이 아이콘 -->
                                                <span class="material-symbols-outlined" style="margin-left:50px; font-size: 20px;">
                                                    wifi
                                                </span>
                                                <!-- 배터리 아이콘 -->
                                                <span class="material-symbols-outlined" style="margin-left: 20px; font-size: 30px; transform: scaleX(-1); position:relative; bottom:5px;">
                                                    battery_horiz_075
                                                </span>
                                                <!-- 배터리 퍼센트 -->
                                                <div style="font-size: 14px; margin-left: 3px; margin-top: 5px; position:relative; bottom:5px; font-weight: 800;">75%</div>
                                                <!-- 주행 상태 -->
                                                <div class="stop" id="statusDisplay" style="margin-left:10px; width: 100px; height:20px; border-radius:1rem; color:white; font-size: 11px; font-weight: 800; text-align: center;">
                                                    정지
                                                </div>

                                            </div>
                                        </div>
                                        <!-- 상세 내용 -->
                                        <div style="display: flex;">
                                            <h6 class="card-subtitle mb-2 text-body-secondary" style="margin-top: 8px; font-size: 12px; font-weight: 800; position:relative; bottom:60px;">작업기간: {{card.start_date_year}}/{{card.start_date_month}}/{{card.start_date_day}} ~ {{card.end_date_year}}/{{card.end_date_month}}/{{card.end_date_day}}</h6>
                                            <div id="expected_hour" style="font-weight: bold;margin-left: 45px;margin-top: 7.5px; font-size: 12px; font-weight: 800; position:relative; bottom:60px;color: rgb(77, 77, 77);">예상시간: 0분</div>
                                        </div>
                                        <div style="display: flex;">
                                            <div class="progress" style="position:relative; bottom:54px; flex:3;" role="progressbar" aria-label="Success example" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                                                <div class="progress-bar bg-success" id="progress" style="width: 25%">작업률: 0%</div>
                                            </div>
                                            <div style="flex:1;"></div>
                                        </div>
                                        <div style="display: flex; justify-content: end; position:relative; bottom:90px; ">    
                                        <!-- 작업제거 버튼 -->
                                            <a href=#>
                                                <button id="del-{{ card.id }}" onclick="handleDelClick(this.id)" type="button" class="btn btn-outline-danger" style="margin-left: 10px; margin-top: 15px; font-size:0px; --bs-btn-padding-y: .0rem; --bs-btn-padding-x: .5rem; --bs-btn-border-radius: 0.2rem; border-width:1px; padding-bottom: 0px;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16" style="display: inline-block; vertical-align: middle; line-height: 1; padding-top: 0px;">
                                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                                    </svg>
                                                    <div style="font-size: 12px; font-weight: 800; display: inline-block; vertical-align: middle; line-height: 1;">작업제거</div>
                                                </button> 
                                            </a>
                                        </div>

                                        <div style="display: flex; justify-content: end; position:relative; bottom:155px; right:52px; z-index: 4;">    
                                        <!-- 작업 play 버튼 -->
                                            <a href=#>
                                                <button type="button" id="startBut" onclick="startSimulation()" class="btn btn-outline-primary" style="margin-left: 10px; margin-top: 15px; font-size:0px; --bs-btn-padding-y: .0rem; --bs-btn-padding-x: .5rem; --bs-btn-border-radius: 0.2rem; border-width:1px; padding-bottom: 0px;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                                                        <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>
                                                    </svg>
                                                </button> 
                                            </a>
                                        </div>
                                        
                                        <div style="display: flex; justify-content: end; position:relative; bottom:188px; ">    
                                        <!-- 작업 pause 버튼 -->
                                            <a href=#>
                                                <button type="button" onclick="toggleSimulation()" class="btn btn-outline-primary" style="margin-left: 10px; margin-top: 15px; font-size:0px; --bs-btn-padding-y: .0rem; --bs-btn-padding-x: .5rem; --bs-btn-border-radius: 0.2rem; border-width:1px; padding-bottom: 0px;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play-fill" viewBox="-4 0 16 16" style="margin-right: 0;">
                                                        <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>
                                                    </svg>
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause" viewBox="4 0 16 16">
                                                        <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5m4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5"/>
                                                    </svg>
                                                </button> 
                                            </a>
                                        </div>
                                        
                                        
                                            
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>

        </div>
        <!-- 구글맵 도시 -->
        <div class="map_page">  
            <!-- 경작지 제거 -->
            <div style="position: absolute; z-index: 3;">
                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#exampleModal" style=" --bs-btn-border-radius: 0rem; width: 25px; height: 123px; position: relative; right:25px; padding: 2px;;">
                    <span class="material-symbols-outlined" style="font-size: 20px;">
                        delete
                    </span>
                </button>
            </div>
            <!-- 경작지 제거 모달 -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title fs-5" id="exampleModalLabel">경고</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                        경작지를 정말로 제거하시겠습니까?
                        </div>
                        &nbsp;
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">닫기</button>
                            <a href="{% url 'farm:delete_farmfield' %}">
                                <button type="button" class="btn btn-outline-danger">경작지 제거</button>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div id="map" style="width: 100%; height: 613px"></div>
        </div>

        <script>
            var field_string = "{{ wea.location }}";
            var decodedString = new DOMParser().parseFromString('<!doctype html><body>' + field_string, 'text/html').body.textContent;
            var obj = JSON.parse(decodedString.replace(/'/g, '"'));
            var locationLatLng = new google.maps.LatLng(obj.lat, obj.lng);
            
            var loc_list = "{{ wea.location_list }}";
            var decodedString2 = new DOMParser().parseFromString('<!doctype html><body>' + loc_list, 'text/html').body.textContent;
            var fieldPaths = JSON.parse(decodedString2.replace(/'/g, '"'));

            var map;
            var markers = [];
            var traveled_path = JSON.parse('{{ traveled_path_json|escapejs }}');
            var expected_path = JSON.parse('{{ expected_path_json|escapejs }}');
            var roll_past = JSON.parse('{{ roll_data_past_json|escapejs }}');
            var roll_future = JSON.parse('{{ roll_data_future_json|escapejs }}');
            var pitch_past = JSON.parse('{{ pitch_data_past_json|escapejs }}');
            var pitch_future = JSON.parse('{{ pitch_data_future_json|escapejs }}');
            var intervalId;
            var traveled_path_polyline; // 전역 변수로 선언
            var expected_path_polyline;
            var traveled_path_coords;
            var expected_path_coords;
            var simulationRunning = false;
            var lastCoordinate;
            var lastMarker;
            var newMarker;
            var progress = 0; // 진행률을 나타내는 변수
            var expected_hour = 0;

            // 이제 fieldPaths를 사용하여 구글맵 polygon의 paths로 전달할 수 있습니다.

            // 맵을 초기화하고 표시하는 스크립트 부분
            function initMap() {
                
                var mapOptions = {
                    center: locationLatLng,
                    
                    zoom: 20,
                    mapTypeControl: false,
                    mapTypeId: google.maps.MapTypeId.HYBRID,
                };
                map = new google.maps.Map(document.getElementById('map'), mapOptions);
                var geocoder = new google.maps.Geocoder();

                geocoder.geocode({ 'location': locationLatLng }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[0]) {
                        var formattedAddress = results[0].formatted_address.slice(5);
                        var loc_element = document.getElementById('now_loc');
                        loc_element.innerHTML = '<div style="white-space:nowrap; font-size:18px; color:black; flex:7;">주간예보 <span style="transform: rotate(180deg); position:relative; top:5px; color:rgb(174, 174, 174);" class="material-symbols-outlined">error</span> </div>' + '<div style="flex:1; white-space:nowrap; margin-top:-8px;">' + formattedAddress + '<span class="material-symbols-outlined" style="margin-left:2px; position:relative; top:5px;">location_on</span></div>'
                    } else {
                        
                    }
                } 
                var polygon = new google.maps.Polygon({
                    paths: fieldPaths,
                    strokeColor: '#FF0000', // 선 색상
                    strokeOpacity: 0.6, // 선 투명도
                    strokeWeight: 5, // 선 두께
                    fillColor: '#000000',
                    fillOpacity: 0.1,
                });
                polygon.setMap(map);                
                });

                var traveled_path_coords = traveled_path.map(coord => new google.maps.LatLng(coord[0], coord[1]));
                var expected_path_coords = expected_path.map(coord => new google.maps.LatLng(coord[0], coord[1]));

                // 폴리라인 그리기
                traveled_path_polyline = new google.maps.Polyline({
                    path: traveled_path_coords,
                    geodesic: true,
                    strokeColor: '#FFCC00', // 노란색
                    strokeOpacity: 1.0,
                    strokeWeight: 4
                });
                traveled_path_polyline.setMap(map);

                expected_path_polyline = new google.maps.Polyline({
                    path: expected_path_coords,
                    geodesic: true,
                    strokeColor: '#C0C0C0', // 흰색
                    strokeOpacity: 1.0,
                    strokeWeight: 2
                });
                expected_path_polyline.setMap(map);
            }

            function startSimulation() {
                intervalId = setInterval(updatePath, 1000); // 1초 간격으로 예상 경로를 주행
                simulationRunning = true;
            }

            function toggleSimulation() {
                if (simulationRunning) {
                    stopSimulation();
                } else {
                    startSimulation();
                }
            }

            function stopSimulation() {
                clearInterval(intervalId); // 시뮬레이션 중지
                simulationRunning = false;
                var statusDisplay = document.getElementById("statusDisplay");
                statusDisplay.classList.add("stop");
                statusDisplay.textContent = "정지";
            }

            function updatePath() {
                if (expected_path.length > 0) {
                    console.log(expected_path.length);
                    // traveled_path의 마지막 좌표를 expected_path의 첫 좌표로 이동
                    traveled_path.push(expected_path[0]);
                    // expected_path의 첫 좌표 삭제
                    expected_path.shift();

                    roll_past.push(roll_future[0]);
                    roll_future.shift();
                    pitch_past.push(pitch_future[0]);
                    pitch_future.shift();

                    // 마지막 마커를 업데이트
                    if (markers.length > 0) {
                        var marker = markers[markers.length - 1];
                        marker.setPosition(new google.maps.LatLng(traveled_path[traveled_path.length - 1][0], traveled_path[traveled_path.length - 1][1]));
                        marker.setIcon({
                            url: 'https://cdn-icons-png.flaticon.com/512/10274/10274087.png',
                            scaledSize: new google.maps.Size(35, 35),
                            anchor: new google.maps.Point(17.5, 15)
                        });
                        console.log(markers);
                    } else {
                        // 처음 마커 생성
                        var marker = new google.maps.Marker({
                            position: new google.maps.LatLng(traveled_path[traveled_path.length - 1][0], traveled_path[traveled_path.length - 1][1]),
                            map: map,
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 4,
                                fillColor: '#FFCC00', // 노란색
                                fillOpacity: 1,
                                strokeWeight: 0
                            }
                        });
                        marker.setIcon({
                            url: 'https://cdn-icons-png.flaticon.com/512/10274/10274087.png',
                            scaledSize: new google.maps.Size(35, 35),
                            anchor: new google.maps.Point(17.5, 15)
                        });
                        markers.push(marker);
                    }

                    // 폴리라인 업데이트
                    var traveled_path_coords = traveled_path.map(coord => new google.maps.LatLng(coord[0], coord[1]));
                    var expected_path_coords = expected_path.map(coord => new google.maps.LatLng(coord[0], coord[1]));
                    traveled_path_polyline.setPath(traveled_path_coords);
                    expected_path_polyline.setPath(expected_path_coords);

                    var lastAngle = Math.abs(roll_past[roll_past.length - 1]);

                    if(lastAngle > 30) {
                        if(lastAngle > 45) {
                            window.alert("전복!");
                            toggleSimulation();
                            var lastCoordinate = traveled_path[traveled_path.length - 1];
                            if (lastMarker) {
                                lastMarker.setMap(null); // 이전의 마커가 있으면 지도에서 제거합니다.
                            }
                            var lastMarker = new google.maps.Marker({
                                position: new google.maps.LatLng(lastCoordinate[0], lastCoordinate[1]),
                                map: map,
                                zIndex: 9999,
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 4,
                                    fillColor: '#FF0000', // 빨간색
                                    fillOpacity: 1,
                                    strokeWeight: 0
                                }
                            });
                        }
                        else {
                            window.alert("전복위험!");
                            toggleSimulation();
                            var lastCoordinate = traveled_path[traveled_path.length - 1];
                            if (lastMarker) {
                                lastMarker.setMap(null); // 이전의 마커가 있으면 지도에서 제거합니다.
                            }
                            var lastMarker = new google.maps.Marker({
                                position: new google.maps.LatLng(lastCoordinate[0], lastCoordinate[1]),
                                map: map,
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 4,
                                    fillColor: '#FF0000', // 빨간색
                                    fillOpacity: 1,
                                    strokeWeight: 0
                                },
                                zIndex: 9999,
                            });
                        }
                    } else {
                        console.log(lastAngle);
                    }
                    updateProgress(); // 진행률 업데이트

                    var statusDisplay = document.getElementById("statusDisplay");
                    
                    if (simulationRunning) {
                        statusDisplay.classList.remove("stop"); // 정지 클래스 제거
                        if (!statusDisplay.classList.contains("autonomous-driving")) {
                        statusDisplay.classList.add("autonomous-driving");
                        }
                        statusDisplay.textContent = "자율주행 중";
                    } else {
                        statusDisplay.classList.remove("autonomous-driving"); // 자율주행 클래스 제거
                        if (!statusDisplay.classList.contains("stop")) {
                            statusDisplay.classList.add("stop");
                        }
                        
                        statusDisplay.textContent = "정지";
                    }
                    
                    
                } else {
                    clearInterval(intervalId); // expected_path가 더 이상 없을 때 인터벌 정지
                }
            }
            
            function updateProgress() {
                var progressValue = (traveled_path.length / (expected_path.length + traveled_path.length)) * 100;
                progressValue = Math.floor(progressValue); // 소수점 이하 부분을 제거하여 정수로 변환
                const progressBar = document.getElementById("progress");
                progressBar.innerText = "진행률: " + progressValue + "%";
                progressBar.style.width = progressValue + "%"; // progress bar의 너비를 설정

                // 예상 시간 계산 및 할당
                var expectedHourValue = expected_path.length * 2.5 / 0.4 / 60;
                expectedHourValue = Math.floor(expectedHourValue);
                const expectedHour = document.getElementById("expected_hour");
                expectedHour.innerText = "예상시간: " + expectedHourValue + "분";
            }
                
            var startBut = document.getElementById('startBut');
            if (startBut) {
                startBut.addEventListener('click', function() {    
                    startBut.disabled = true;
                })
            }
        


//   -----------------------------------------------------------------------------------------------------------------


            // 맵을 초기화하는 함수를 호출합니다.
            window.onload = function() {
                initMap();
                updateProgress();
            };
            var accordionButton = document.querySelector('.accordion-button');

            // 아코디언이 펼쳐진 상태인지 확인
            function isAccordionExpanded() {
                return accordionButton.classList.contains('collapsed') === false;
            }

            function applyShadowBasedOnAccordionState() {
                
                if (isAccordionExpanded()) {
                    accordionButton.style.boxShadow = '0 5px 5px rgba(0, 0, 0, 0.3)';
                } else {
                    accordionButton.style.boxShadow = 'none';
                }
            }

            // 페이지 로드시 초기 적용
            applyShadowBasedOnAccordionState();

            // 아코디언 상태 변화 감지 및 그림자 적용
            accordionButton.addEventListener('click', applyShadowBasedOnAccordionState);

        </script>
        <script type="text/javascript" src="{% static 'js/card.js' %}"></script>
    </main>  
</body>
</html>
