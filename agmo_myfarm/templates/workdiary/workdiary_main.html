<!doctype html>
<html lang="en">

  <head>
    <!-- 필요한 meta tags 첨부하는 곳-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <!-- Bootstrap CSS부분-->
    <title>작업일지</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous"> 
  <style>
  
  .rightBody{

    background-color:white;
    width: 781px;
    height: 100%;
    display: inline-block;
    
  }
  .leftBody{
    width: 748px;
    height: 618px;
    background-color: #f8f6f6; padding: 10px; border: 2px solid #ccc;
    border-radius: 25px;
    margin-left:2px;
    margin-top: 8px;
    border: 2px solid gray; /* 2px 실선 테두리를 검은색으로 지정 */
    display: inline-block;
  }
  .downBody{
    width: 731px;
    height:488px;
    display:inline-block;
    overflow-y: auto;
  }
  #calendar {
    
    margin-top:90px;
    
    display: flex;
    flex-wrap: wrap;
    gap: 0px; /* 날짜 사이의 간격을 설정합니다. */
  }
  .day {
    font-weight: bold;
    display: inline-block;
    width: 105.77px;
    height: 105px;
    text-align: left;
    cursor: pointer;
    border: 1px solid #eaeaea;
    padding-left: 8px;
    padding-top: 6px;
  }
  
  .fieldRecord{
    width: 711px;
    border-radius: 15px;
    margin-top:10px;
    margin-left: 3px;
    border: 2px solid black; /* 2px 실선 테두리를 검은색으로 지정 */
    display: inline-block;
    background-color: white;
  }
  p {
    line-height: 1;
    }
  .weather_icon {
    margin: 30px;
    font-size: 24px;
    font-weight: 800;
  }
  .bold{
    font-weight: bold;
  }
  .flex{
    display: flex;
  }
  .material-symbols-outlined{
    margin-left: 8px;
    margin-top: 11px;
    font-size: 20px;
  }
  </style>
  </head>


  <body>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
  <header>
      <!-- 헤더 고정 -->
      {% include 'workdiary/header.html' %}
  </header>

  <div style="display:flex;">
    <div class="rightBody">
      <div style="display:flex">
        <p style="font-size: 40px;font-weight: bold;margin-top: 50px;text-decoration: underline;margin-left:56px">FEBRUARY</p>
        <p style="font-size: 40px;font-weight:bold;margin-top: 50px;margin-left:20px">2024</p>
      </div>
      <div id="calendar"></div>
    </div>

    <div class="leftBody">
      <div>
        <div style="display: flex;">
          <p style="font-size: 25px;margin-left: 10px;font-weight: bold;margin-top: 10px;">2024.2.</p>
          <div style="font-size: 25px;margin-top:10px;" id="leftBody"></div>
        </div>
        <hr>
        <div class="downBody">
          <div id="workInfo"></div>
        </div>
      </div>
    </div>

  <script>
    // 달력을 만들고 날짜에 클릭 이벤트를 추가합니다.
    const calendar = document.getElementById('calendar');
    const workInfo = document.getElementById('workInfo');
    leftBody.innerHTML=`<p class="bold">{{ today_day }}</p>`
    //페이지에 처음 들어왔을때 오늘거 표시하게 하기 위함.
    fetch(`workinfo?date={{ today_day }}`)
        
        .then(response => {
            if (!response.ok) {
                throw new Error('작업 정보를 찾을 수 없습니다.');
            }
            return response.json();
        })
        .then(data => {
            // 받은 데이터를 화면에 표시
            for (let j = 0; j < data.length; j++) {
                const work = data[j];
                workInfo.innerHTML += `
                <div class="fieldRecord card">
                  <div style="display:flex">
                    <p class="bold" style="font-size: 18px;margin-left:8px;margin-top:8px"> ${work.field_name}</p>
                    ${work.machine_name === '파종기' ? '<span class="material-symbols-outlined" style="z-index: 2; position:relative; bottom:5px;">wrist</span>' :
                    work.machine_name === '써레' ? '<span class="material-symbols-outlined" style="z-index: 2; position:relative; bottom:5px;">auto_towing</span>' :
                    work.machine_name === '스프레이어' ? '<span class="material-symbols-outlined" style="z-index: 2; position:relative; bottom:5px;">sprinkler</span>' : ''}
                    <div class="progress" style="margin-left:8px; margin-top:9px;width:490px" role="progressbar" aria-label="Success example" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                      <div class="progress-bar bg-success" style="width: 25%">작업률: 25%</div>
                    </div>
                    <button type="button" class="btn" style="height: 24px;margin-left:10px;color:rgb(0, 161, 49);  margin-top:3px; --bs-btn-padding-y: .2rem; --bs-btn-padding-x: .4rem; --bs-btn-border-radius: 0rem; border-bottom: 2px solid rgb(0, 161, 49);">
                        <div style="font-size: 14px;font-weight:bold">작업편집</div>
                    </button>
                  </div> 
                  <p style="margin-left:8px;">작업 이름: ${work.work_name}</p>
                  <p style="margin-left:8px;">작물: ${work.crop}</p>
                  <p style="margin-left:8px;margin-top:3px;">상세 메모: ${work.user_memo}</p>
                </div>
            `;
            }
        })
        .catch(error => console.error('Error:', error));

    // 달력을 채워넣는 함수
      for (let i = 1; i <= 28; i++) { // 간단하게 28일만 추가
        const day = document.createElement('div');
        day.classList.add('day');
        day.textContent = i;
        day.addEventListener('click', () => {
          // 클릭한 날짜에 대한 작업 정보 요청
          leftBody.innerHTML=`<p class="bold">${i}</p>`
          fetch(`workinfo?date=${i}`) 
          .then(response => {
            if (!response.ok) {
                throw new Error('작업 정보를 찾을 수 없습니다.');
            }
            return response.json();
          })
            .then(data => {
              // 받은 데이터를 화면에 표시
              workInfo.innerHTML = ''; // 기존의 작업 정보를 초기화
              for (let j = 0; j < data.length; j++) {
                const work = data[j];
                workInfo.innerHTML += `
                <div class="fieldRecord card">
                  <div style="display:flex">
                    <p class="bold" style="font-size: 18px;margin-left:8px;margin-top:8px"> ${work.field_name}</p>
                    ${work.machine_name === '파종기' ? '<span class="material-symbols-outlined" style="z-index: 2; position:relative; bottom:5px;">wrist</span>' :
                    work.machine_name === '써레' ? '<span class="material-symbols-outlined" style="z-index: 2; position:relative; bottom:5px;">auto_towing</span>' :
                    work.machine_name === '스프레이어' ? '<span class="material-symbols-outlined" style="z-index: 2; position:relative; bottom:5px;">sprinkler</span>' : ''}
                    <div class="progress" style="margin-left:8px; margin-top:9px;width:490px" role="progressbar" aria-label="Success example" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                      <div class="progress-bar bg-success" style="width: 25%">작업률: 25%</div>
                    </div>
                    <button type="button" class="btn" style="height: 24px;margin-left:10px;color:rgb(0, 161, 49);  margin-top:3px; --bs-btn-padding-y: .2rem; --bs-btn-padding-x: .4rem; --bs-btn-border-radius: 0rem; border-bottom: 2px solid rgb(0, 161, 49);">
                        <div style="font-size: 14px;font-weight:bold">작업편집</div>
                    </button>
                  </div> 
                  <p style="margin-left:8px;">작업 이름: ${work.work_name}</p>
                  <p style="margin-left:8px;">작물: ${work.crop}</p>
                  <p style="margin-left:8px;margin-top:3px;">상세 메모: ${work.user_memo}</p>
                </div>
            `;
              }
            })
            .catch(error => console.error('Error:', error));
        });
        calendar.appendChild(day);
      }
      // 페이지 로드 시 달력을 채웁니다.
      fillCalendar();
  </script>



</body>